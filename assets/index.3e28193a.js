var ft=Object.defineProperty;var mt=(o,e,t)=>e in o?ft(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var l=(o,e,t)=>(mt(o,typeof e!="symbol"?e+"":e,t),t);const gt=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}};gt();function F(){}function lt(o){return o()}function st(){return Object.create(null)}function M(o){o.forEach(lt)}function wt(o){return typeof o=="function"}function bt(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}function yt(o){return Object.keys(o).length===0}function u(o,e){o.appendChild(e)}function _t(o,e,t){o.insertBefore(e,t||null)}function dt(o){o.parentNode.removeChild(o)}function f(o){return document.createElement(o)}function xt(o){return document.createTextNode(o)}function b(){return xt(" ")}function k(o,e,t,n){return o.addEventListener(e,t,n),()=>o.removeEventListener(e,t,n)}function h(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function vt(o){return Array.from(o.childNodes)}let T;function N(o){T=o}function kt(){if(!T)throw new Error("Function called outside component initialization");return T}function Ct(o){kt().$$.on_mount.push(o)}const D=[],it=[],A=[],rt=[],Ot=Promise.resolve();let R=!1;function Lt(){R||(R=!0,Ot.then(ut))}function q(o){A.push(o)}const B=new Set;let U=0;function ut(){const o=T;do{for(;U<D.length;){const e=D[U];U++,N(e),zt(e.$$)}for(N(null),D.length=0,U=0;it.length;)it.pop()();for(let e=0;e<A.length;e+=1){const t=A[e];B.has(t)||(B.add(t),t())}A.length=0}while(D.length);for(;rt.length;)rt.pop()();R=!1,B.clear(),N(o)}function zt(o){if(o.fragment!==null){o.update(),M(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(q)}}const It=new Set;function $t(o,e){o&&o.i&&(It.delete(o),o.i(e))}function Dt(o,e,t,n){const{fragment:s,on_mount:r,on_destroy:i,after_update:a}=o.$$;s&&s.m(e,t),n||q(()=>{const d=r.map(lt).filter(wt);i?i.push(...d):M(d),o.$$.on_mount=[]}),a.forEach(q)}function Nt(o,e){const t=o.$$;t.fragment!==null&&(M(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Tt(o,e){o.$$.dirty[0]===-1&&(D.push(o),Lt(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function Mt(o,e,t,n,s,r,i,a=[-1]){const d=T;N(o);const c=o.$$={fragment:null,ctx:null,props:r,update:F,not_equal:s,bound:st(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:st(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};i&&i(c.root);let p=!1;if(c.ctx=t?t(o,e.props||{},(m,g,..._)=>{const y=_.length?_[0]:g;return c.ctx&&s(c.ctx[m],c.ctx[m]=y)&&(!c.skip_bound&&c.bound[m]&&c.bound[m](y),p&&Tt(o,m)),g}):[],c.update(),p=!0,M(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const m=vt(e.target);c.fragment&&c.fragment.l(m),m.forEach(dt)}else c.fragment&&c.fragment.c();e.intro&&$t(o.$$.fragment),Dt(o,e.target,e.anchor,e.customElement),ut()}N(d)}class Et{$destroy(){Nt(this,1),this.$destroy=F}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const s=n.indexOf(t);s!==-1&&n.splice(s,1)}}$set(e){this.$$set&&!yt(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const St={functions:{visualize:{inputs:["Video ID","Show Controls"],outputs:[],functionInit:o=>{o.yt=o.dom.querySelector(".yt")},functionUpdate:(o,e,t)=>{e||(e="m4-HM_sCvtQ"),o.yt.src="https://www.youtube.com/embed/"+e+"?autoplay=1&controls="+(t?"1":"0")}}},elements:[{type:"input-text",name:"Video ID"},{type:"input-bool",name:"Show Controls"},{type:"custom",html:`
        <iframe class="yt rounded-lg" width="560" height="315" src="https://www.youtube.com/embed/m4-HM_sCvtQ?autoplay=1&controls=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      `}]},Ut={functions:{output:{inputs:["Input 1","Input 2","Operation"],outputs:["Result"],functionUpdate:(o,e,t,n)=>{switch(n){case"+":return e+t;case"-":return e-t;case"*":return e*t;case"/":return e/t;default:return 0}}}},elements:[{type:"output-text",name:"Result"},[{type:"ui-dropdown",name:"Operation",values:[{value:"+",label:"Add"},{value:"-",label:"Subtract"},{value:"*",label:"Multiply"},{value:"/",label:"Divide"}]}],[{type:"input-text",name:"Input 1"}],[{type:"input-text",name:"Input 2"}]]},At={functions:{output:{inputs:["Input"],outputs:[],functionInit:(o,e)=>{o.display=o.dom.querySelector(".display")},functionUpdate:(o,e)=>{o.display.innerText=e}}},elements:[{type:"input-text",name:"Input"},{type:"custom",name:"Display",html:`
      <div class="bg-red rounded-lg">
        <span class="display text-3xl"></span>
      </div>
      `}]};function at(o,e,t){return o>=e&&o<=t||o>=t&&o<=e}function ct(o,e,t){const n=t.zoom,s=t.zoom,r=-o*t.zoom+t.cameraWidth/2,i=-e*t.zoom+t.cameraHeight/2;return`${n},0,0,0,0,${s},0,0,0,0,1,0,${r},${i},0,1`}function G(o,e){if(e.name==="")return;const t=document.createElement("span");t.classList.add("sl-label"),t.innerText=e.name,o.appendChild(t)}class ht{constructor(e){l(this,"g");l(this,"gid");l(this,"position_x");l(this,"position_y");this.g=e,e.gid++,this.gid=e.gid.toString(),this.position_x=0,this.position_y=0}domMouseDown(e){this.g.isMouseDown=!0,this.g.targetNode=this,this.g.mousedown_x=e.clientX,this.g.mousedown_y=e.clientY,this.g.dx=0,this.g.dy=0,this.g.dx_offset=0,this.g.dy_offset=0,this.onFocus(),this.customMouseDown(e),e.stopPropagation()}customMouseDown(e){console.debug(e)}domMouseUp(){}onFocus(){}offFocus(){}onDrag(){}onPan(){}}class Q extends ht{constructor(t,n,s){super(s);l(this,"parent");l(this,"config");l(this,"dom");this.config=t,this.parent=n,this.dom=null}}class pt extends Q{constructor(t,n,s,r){super(t,n,s);l(this,"connector_x");l(this,"connector_y");l(this,"c_total_offset_x");l(this,"c_total_offset_y");l(this,"name");l(this,"parentContent");l(this,"connector");this.connector_x=0,this.connector_y=0,this.c_total_offset_x=0,this.c_total_offset_y=0,this.dom=null,this.parentContent=r,this.connector=null,t.name?this.name=t.name:(s.gid++,this.name=s.gid.toString()),this.parent.elements[this.name]=this,this.g.globalNodes[this.gid]=this}pxToInt(t){return parseInt(t.substring(0,t.length-2))}updateDOMproperties(){const t=this.parent.nodeContainerOffsetLeft,n=this.parent.nodeContainerOffsetTop,s=0;this.pxToInt(window.getComputedStyle(this.parentContent).marginLeft)+this.pxToInt(window.getComputedStyle(this.parentContent).paddingLeft)+this.pxToInt(window.getComputedStyle(this.parentContent).borderLeftWidth)+this.parentContent.offsetLeft;const r=this.parentContent.offsetTop,i=this.pxToInt(window.getComputedStyle(this.connector).marginLeft)+this.pxToInt(window.getComputedStyle(this.connector).paddingLeft)+this.pxToInt(window.getComputedStyle(this.connector).borderLeftWidth)+this.connector.offsetLeft,a=this.pxToInt(window.getComputedStyle(this.connector).marginTop)+this.pxToInt(window.getComputedStyle(this.connector).paddingTop)+this.pxToInt(window.getComputedStyle(this.connector).borderTopWidth)+this.connector.offsetTop;console.debug(`connector_offset_x: ${i} connector_offset_y: ${a}`);const d=this.connector.getBoundingClientRect().width,c=this.connector.getBoundingClientRect().height;this.c_total_offset_x=t+s+i+d/2,this.c_total_offset_y=n+r+a+c/2}setLineXY(t,n,s){t.setAttribute("x1",""+0),t.setAttribute("y1",""+0),t.setAttribute("x2",""+n),t.setAttribute("y2",""+s),t.setAttribute("stroke-width",`${4*this.g.zoom}`)}}class Ft extends pt{constructor(t,n,s,r){super(t,n,s,r);l(this,"inputDOM");l(this,"inputValue");l(this,"peerOutput");this.inputDOM=null,this.peerOutput=null;const i=document.createElement("div");i.classList.add("sl-input");const a=document.createElement("span");switch(a.classList.add("sl-input-connector"),a.id=`input-${this.gid}`,a.onmousedown=this.domMouseDown.bind(this),i.appendChild(a),this.inputValue=()=>{},t.type){case"input-text":{G(i,t);const d=document.createElement("input");d.classList.add("sl-input-text"),d.type="text",i.appendChild(d),this.inputDOM=d,d.onkeyup=()=>{var c;(c=this.parent)==null||c.findLeaf()},this.inputValue=()=>this.inputDOM.value}break;case"input-bool":{G(i,t);const d=document.createElement("input");d.classList.add("sl-input-bool"),d.type="checkbox",i.appendChild(d),this.inputDOM=d,d.onchange=()=>{var c;(c=this.parent)==null||c.findLeaf()},this.inputValue=()=>this.inputDOM.checked}break}this.connector=a,this.dom=i}domMouseDown(t){this.peerOutput&&(super.domMouseDown(t),this.g.targetNode=this.peerOutput,this.g.dx_offset=(this.connector_x-this.peerOutput.connector_x)*this.g.zoom,this.g.dy_offset=(this.connector_y-this.peerOutput.connector_y)*this.g.zoom,this.g.dx=this.g.dx_offset,this.g.dy=this.g.dy_offset,this.peerOutput.customMouseDown(t),this.peerOutput.disconnectFromInput(this),t.stopPropagation())}updateConnectorPosition(){this.connector_x=this.parent.position_x+this.c_total_offset_x,this.connector_y=this.parent.position_y+this.c_total_offset_y}disconnectFromOutput(){var t;this.peerOutput=null,(t=this.dom)==null||t.classList.remove("connected")}connectToOutput(t){var n;this.peerOutput=t,(n=this.dom)==null||n.classList.add("connected")}nodeDrag(){this.updateConnectorPosition(),this.peerOutput&&this.peerOutput.nodeDrag()}getValue(){return this.peerOutput?this.peerOutput.getValue():this.inputDOM?this.inputValue():null}}class Pt extends pt{constructor(t,n,s,r){super(t,n,s,r);l(this,"val");l(this,"svgTmp");l(this,"svgs");this.val=null,this.svgTmp={svg:null,line:null},this.svgs=[];const i=document.createElement("div");i.classList.add("sl-output"),G(i,t);const a=document.createElement("span");a.classList.add("sl-output-connector"),a.id=`output-${this.gid}`,a.onmousedown=this.domMouseDown.bind(this),i.appendChild(a),this.connector=a,this.dom=i}connectToInput(t){if(console.debug("Connecting to input: ",t),this===t.peerOutput){console.debug("Already connected");return}t.peerOutput&&(console.debug("Disconnecting from: ",t.peerOutput),t.peerOutput.disconnectFromInput(t),t.disconnectFromOutput()),console.debug("Now connecting to: ",t),t.connectToOutput(this);const n=this.createNewSVG(),s=n[0],r=n[1],i={svg:s,line:r,to:t,from:this,connector_x:this.connector_x,connector_y:this.connector_y,x2:0,y2:0,connector:this};this.svgs.push(i),this.g.globalLines.push(i),this.g.canvas.appendChild(s),this.setLineXY(r,t.connector_x-this.connector_x,t.connector_y-this.connector_y),this.parent.outputCount++,t.parent.inputCount++}disconnectFromInput(t){console.debug("Disconnecting from input: ",t);for(const n of this.svgs)if(n.to==t){this.g.canvas.removeChild(n.svg),this.svgs=this.svgs.filter(s=>s!=n),this.g.globalLines=this.g.globalLines.filter(s=>s!=n),console.debug("Deleted line: ",n);break}t.disconnectFromOutput(),this.parent.outputCount--,t.parent.inputCount--}updateConnectorPosition(){this.connector_x=this.parent.position_x+this.c_total_offset_x,this.connector_y=this.parent.position_y+this.c_total_offset_y}getValue(){return this.parent.exec(),this.val}setValue(t){this.val=t}moveToParent(){if(this.updateConnectorPosition(),this.svgTmp.line&&(this.svgTmp.svg.style.transform=`translate3d(${this.connector_x}px, ${this.connector_y}px, 0)`),!(this.svgs.length<1))for(const t of this.svgs)t.svg.style.transform=`translate3d(${this.connector_x}px, ${this.connector_y}px, 0)`,t.connector_x=this.connector_x,t.connector_y=this.connector_y,t.x2=t.to.connector_x-this.connector_x,t.y2=t.to.connector_y-this.connector_y,this.setLineXY(t.line,t.x2,t.y2)}createNewSVG(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("sl-connector-svg"),t.style.pointerEvents="none",t.style.position="absolute",t.style.overflow="visible",t.setAttribute("width","4"),t.setAttribute("height","4"),t.style.willChange="transform";const n=document.createElementNS("http://www.w3.org/2000/svg","line");return n.classList.add("sl-connector-line"),n.setAttribute("stroke-width",`${4*this.g.zoom}`),t.appendChild(n),this.updateConnectorPosition(),t.style.transform=`translate3d(${this.connector_x}px, ${this.connector_y}px, 0)`,this.g.canvas.appendChild(t),[t,n]}customMouseDown(t){const n=this.createNewSVG();this.svgTmp.svg=n[0],this.svgTmp.line=n[1],this.moveToParent(),this.setLineXY(this.svgTmp.line,this.g.dx,this.g.dy)}onDrag(){let t=9999,n=0,s=0;const r=this.g.hoverDOM;if(r&&r.id&&r.id.startsWith("input-")){const i=r.id.split("-")[1],a=this.g.globalNodes[i];a.updateConnectorPosition(),n=a.connector_x,s=a.connector_y,t=Math.sqrt(Math.pow(this.connector_x+this.g.dx/this.g.zoom-n,2)+Math.pow(this.connector_y+this.g.dy/this.g.zoom-s,2))}t<40?this.setLineXY(this.svgTmp.line,n-this.connector_x,s-this.connector_y):this.setLineXY(this.svgTmp.line,this.g.dx/this.g.zoom,this.g.dy/this.g.zoom)}nodeDrag(){this.moveToParent()}domMouseUp(){const t=this.g.hoverDOM;if(t&&t.id&&t.id.startsWith("input-")){console.debug("Connecting to input: ",t.id);const n=this.g.globalNodes[t.id.split("-")[1]];this.connectToInput(n),n.parent.findLeaf()}this.g.canvas.removeChild(this.svgTmp.svg),this.svgTmp={svg:null,line:null}}}class Wt extends Q{constructor(t,n,s,r){super(t,n,s);l(this,"parentContent");l(this,"getUIvalue");l(this,"setUIvalue");l(this,"name");this.parentContent=r,this.name=t.name,this.getUIvalue=()=>null,this.setUIvalue=d=>{console.debug(d)};const i=document.createElement("div");switch(i.classList.add("sl-ui"),t.type){case"ui-paragraph":const d=document.createElement("p");d.style.pointerEvents="none",d.innerText=t.text,i.appendChild(d);break;case"ui-display":const c=document.createElement("p");c.style.pointerEvents="none",c.innerText="Output",i.appendChild(c),this.setSetFunction(m=>{c.innerText=m});break;case"ui-dropdown":const p=document.createElement("select");p.classList.add("sl-ui-dropdown");for(const m of t.values){const g=document.createElement("option");g.innerText=m.label,g.value=m.value,p.appendChild(g)}i.appendChild(p),this.setGetFunction(()=>p.value),this.setExecTrigger(p,"change");break}this.dom=i,this.name&&(this.parent.elements[this.name]=this)}setExecTrigger(t,n){t.addEventListener(n,()=>{var s;(s=this.parent)==null||s.findLeaf()}),console.debug(t,n)}setGetFunction(t){this.getUIvalue=t}setSetFunction(t){this.setUIvalue=t}getValue(){return this.getUIvalue()}setValue(t){return this.setUIvalue(t)}}class Ht extends Q{constructor(t,n,s,r){super(t,n,s);l(this,"parentContent");l(this,"getUIvalue");l(this,"setUIvalue");this.parentContent=r,this.getUIvalue=()=>null,this.setUIvalue=a=>{console.debug(a)};const i=document.createElement("template");i.innerHTML=t.html.trim(),this.dom=i.content.firstChild}setExecTrigger(t,n){console.debug(t,n)}setGetFunction(t){this.getUIvalue=t}setSetFunction(t){this.setUIvalue=t}getValue(){return this.getUIvalue()}setValue(t){return this.setUIvalue(t)}}class X extends ht{constructor(t,n,s=0,r=0){super(n);l(this,"config");l(this,"inputs");l(this,"outputs");l(this,"inputCount");l(this,"outputCount");l(this,"elements");l(this,"dom");l(this,"hasIandO");l(this,"nodeWidth");l(this,"nodeHeight");l(this,"nodeContainerWidth");l(this,"nodeContainerHeight");l(this,"nodeContainerOffsetLeft");l(this,"nodeContainerOffsetTop");l(this,"functions");l(this,"pan_start_x");l(this,"pan_start_y");l(this,"overlapping");this.config=t,this.position_x=s,this.position_y=r,this.inputs=[],this.outputs=[],this.inputCount=0,this.outputCount=0,this.elements={},this.pan_start_x=0,this.pan_start_y=0,this.overlapping=null;const i=document.createElement("div");i.classList.add("sl-node"),i.style.willChange="transform",i.style.position="absolute",i.style.transformOrigin="top left",i.style.position="absolute";const a=document.createElement("div");a.classList.add("sl-node-container"),a.style.position="relative";for(const d of t.elements){const c=document.createElement("div");if(c.style.position="relative",c.style.display="flex",c.style.flexDirection="row",c.classList.add("sl-node-content"),a.appendChild(c),d instanceof Array)for(const p of d){const m=this._initParseComponent(p,c);m&&c.appendChild(m.dom)}else{const p=this._initParseComponent(d,c);p&&c.appendChild(p.dom)}a.appendChild(c)}if(i.appendChild(a),i.id=this.gid,i.onmousedown=this.domMouseDown.bind(this),this.dom=i,this.inputs.length>0&&this.outputs.length>0?this.hasIandO=!0:this.hasIandO=!1,this.g.canvas.appendChild(i),this.nodeWidth=i.offsetWidth,this.nodeHeight=i.offsetHeight,this.nodeContainerWidth=a.offsetWidth,this.nodeContainerHeight=a.offsetHeight,this.nodeContainerOffsetLeft=a.offsetLeft,this.nodeContainerOffsetTop=a.offsetTop,this.updateDOMproperties(),this.g.nodeArray.push(this),new ResizeObserver(()=>{this.updateDOMproperties()}).observe(this.dom),this.functions=[],t.functions){this.functions=t.functions;for(const[d,c]of Object.entries(this.functions))c.functionInit!==void 0&&c.functionInit(this)}}findInput(t){for(const n of this.inputs)if(n.gid===t)return n;return null}findOutput(t){for(const n of this.outputs)if(n.gid===t)return n;return null}_initParseComponent(t,n){let s=null;switch(t.type){case"input-text":case"input-bool":s=new Ft(t,this,this.g,n),s.parent=this,this.g.globalNodes[s.gid]=s,this.inputs.push(s);break;case"output-text":s=new Pt(t,this,this.g,n),s.parent=this,this.g.globalNodes[s.gid]=s,this.outputs.push(s);break;case"ui-display":case"ui-dropdown":case"ui-paragraph":s=new Wt(t,this,this.g,n),s.parent=this,this.g.globalNodes[s.gid]=s;break;case"custom":s=new Ht(t,this,this.g,n),s.parent=this,this.g.globalNodes[s.gid]=s;break;default:console.warn("Unknown type "+t.type)}return s}customMouseDown(t){this.pan_start_x=this.position_x,this.pan_start_y=this.position_y,this.g.focusNode=this}domMouseUp(){if(this.position_x=this.pan_start_x+this.g.dx/this.g.zoom,this.position_y=this.pan_start_y+this.g.dy/this.g.zoom,this.overlapping==null)return;const t=this.overlapping.from,n=this.overlapping.to,s=this.inputs[0],r=this.outputs[0];t.disconnectFromInput(n),t.connectToInput(s),r.connectToInput(n)}onPan(){this.dom.style.transform=`translate3d(${this.position_x}px, ${this.position_y}px, 0)`;for(const t of this.inputs)t.onPan();for(const t of this.outputs)t.onPan()}onDrag(){this.position_x=this.pan_start_x+this.g.dx/this.g.zoom,this.position_y=this.pan_start_y+this.g.dy/this.g.zoom,this.dom.style.transform=`translate3d(${this.position_x}px, ${this.position_y}px, 0)`;for(const n of this.inputs)n.nodeDrag();for(const n of this.outputs)n.nodeDrag();if(this.overlapping=null,!this.hasIandO||this.outputCount>0||this.inputCount>0)return;let t=9999;for(const n of this.g.globalLines)n.line.classList.remove("overlapping"),at(this.position_x+this.nodeWidth/2,n.connector_x,n.connector_x+n.x2)&&at(this.position_y+this.nodeHeight/2,n.connector_y,n.connector_y+n.y2)&&(n.y2+n.connector_x)/2<t&&(this.overlapping=n,t=(n.y2+this.position_y)/2);!this.overlapping||this.overlapping.line.classList.add("overlapping")}onFocus(){for(const t of this.g.nodeArray)t.dom.classList.remove("focused"),t.dom.style.zIndex="10";this.dom.classList.add("focused"),this.dom.style.zIndex="20"}offFocus(){this.dom.classList.remove("focused"),this.dom.style.zIndex="10"}updateDOMproperties(){this.nodeHeight=this.dom.offsetHeight,this.nodeWidth=this.dom.offsetWidth;for(const t of this.inputs)t.updateDOMproperties();for(const t of this.outputs)t.updateDOMproperties()}findLeaf(){var n;let t=0;for(const[s,r]of Object.entries(this.functions))for(const i of r.outputs){const a=this.elements[i];if(a==null){console.warn(`Output '${i}' was not found in elements. Double check '${i}' is defined.`);return}if(!(!a.svgs||a.svgs.length<1)){t++;for(const d of a.svgs)(n=d.to.parent)==null||n.findLeaf()}}t===0&&this.exec()}exec(){if(!!this.functions)for(const[t,n]of Object.entries(this.functions)){const s=[this];for(const i of n.inputs)if(i in this.elements){const a=this.elements[i];s.push(a.getValue())}const r=n.functionUpdate(...s);for(const i of n.outputs){const a=this.elements[i];if(a==null){console.warn(`Output '${i}' was not found in elements. Double check '${i}' is defined.`);return}a.setValue(r)}}}}class Vt{constructor(e){l(this,"g");this.g={canvas:null,canvasContainer:null,canvasBackground:null,isMouseDown:!1,mousedown_x:0,mousedown_y:0,mouse_x:0,mouse_y:0,camera_pan_start_x:0,camera_pan_start_y:0,dx:0,dy:0,dx_offset:0,dy_offset:0,camera_x:0,camera_y:0,zoom:1,cameraWidth:0,cameraHeight:0,targetNode:null,focusNode:null,hoverDOM:null,gid:0,nodeArray:[],globalLines:[],globalNodes:{}};const t=this.g;if(t.canvasContainer=document.getElementById(e),!t.canvasContainer){console.error("Canvas not found");return}t.cameraWidth=t.canvasContainer.clientWidth,t.cameraHeight=t.canvasContainer.clientHeight,console.debug(`Canvas size: ${t.cameraWidth}x${t.cameraHeight}`);const n=document.createElement("div");n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.className="canvas",t.canvasContainer.appendChild(n),t.canvas=n,t.canvas.style.transform=`translate(${t.cameraWidth/2}px, ${t.cameraHeight/2}px)`,t.canvasContainer.tabIndex=0;const s=document.createElement("div");s.id="sl-background",s.style.width=t.cameraWidth*10+"px",s.style.height=t.cameraHeight*10+"px",s.style.transform=`translate(${-t.cameraWidth*5}px, ${-t.cameraHeight*5}px)`,s.style.transformOrigin="center",s.style.zIndex="0",s.style.position="absolute",t.canvas.appendChild(s),t.canvasBackground=s,t.canvasContainer.addEventListener("mousedown",function(r){t.isMouseDown=!0,t.mousedown_x=r.clientX,t.mousedown_y=r.clientY,t.camera_pan_start_x=t.camera_x,t.camera_pan_start_y=t.camera_y,t.focusNode=null;for(const i of t.nodeArray)i.offFocus()}),t.canvasContainer.addEventListener("mousemove",function(r){t.hoverDOM=r.target,t.mouse_x=r.clientX-t.canvasContainer.offsetLeft,t.mouse_y=r.clientY-t.canvasContainer.offsetTop,t.isMouseDown&&(t.dx=r.clientX-t.mousedown_x+t.dx_offset,t.dy=r.clientY-t.mousedown_y+t.dy_offset,t.targetNode==null&&(t.camera_x=t.camera_pan_start_x-t.dx/t.zoom,t.camera_y=t.camera_pan_start_y-t.dy/t.zoom,t.canvas.style.transform=`matrix3d(${ct(t.camera_x,t.camera_y,t)})`,t.canvasBackground.style.transform=`translate(${t.camera_x+-t.cameraWidth*5}px, ${t.camera_y+-t.cameraHeight*5}px)`,t.canvasBackground.style.backgroundPosition=`${-t.camera_x}px ${-t.camera_y}px`,t.canvas.style.cursor="grabbing"))}),t.canvasContainer.addEventListener("wheel",function(r){const i=1*t.zoom*(-r.deltaY/600);if(r.preventDefault(),t.zoom+i<.2){t.zoom=.2;return}else if(t.zoom+i>3){t.zoom=3;return}const a=(t.mouse_x-t.cameraWidth/2)*i,d=(t.mouse_y-t.cameraHeight/2)*i;t.zoom+=i,t.camera_x+=a/t.zoom/t.zoom,t.camera_y+=d/t.zoom/t.zoom,t.canvas.style.transform=`matrix3d(${ct(t.camera_x,t.camera_y,t)})`,r.preventDefault()}),t.canvasContainer.addEventListener("mouseup",function(r){t.isMouseDown=!1,t.canvas.style.cursor="default",t.targetNode==null||t.targetNode.domMouseUp(),t.targetNode=null,t.dx=0,t.dy=0,t.dx_offset=0,t.dy_offset=0}),t.canvasContainer.addEventListener("keydown",r=>{switch(r.key){case"Delete":t.focusNode&&(console.debug("Delete Node "+t.focusNode.gid),this.deleteNode(t.focusNode.gid));break}}),console.info("Initialized SnapLine..."),window.requestAnimationFrame(this.step.bind(this))}step(){this.g.targetNode&&this.g.targetNode.onDrag(),window.requestAnimationFrame(this.step.bind(this))}addNode(e,t,n){const s=new X(e,this.g,t,n);return this.g.globalNodes[s.gid]=s,this.focusNode(s.gid),s}deleteNode(e){var n;if(!(e in this.g.globalNodes))return null;const t=this.g.globalNodes[e];return(n=this.g.canvas)==null||n.removeChild(t.dom),delete this.g.globalNodes[e],e}focusNode(e){return e in this.g.globalNodes?(this.g.globalNodes[e].onFocus(),e):null}connectNodes(e,t,n,s){const r=this.g.globalNodes[e],i=this.g.globalNodes[n];if(!r||!i||!(r instanceof X)||!(i instanceof X))return null;const a=r.findOutput(t),d=i.findInput(s);return!a||!d?null:(a.connectToInput(d),0)}}function Yt(o){let e,t,n,s,r,i,a,d,c,p,m,g,_,y,C,J,P,O,K,E,x,L,Z,w,W,z,tt,H,I,et,V,$,nt,S,Y,ot;return{c(){e=f("main"),t=f("link"),s=b(),r=f("navbar"),i=f("div"),a=f("div"),d=f("label"),d.textContent="Add Node",c=b(),p=f("ul"),m=f("li"),g=f("button"),g.textContent="Math",_=b(),y=f("li"),C=f("button"),C.textContent="YouTube",J=b(),P=f("li"),O=f("button"),O.textContent="Print",K=b(),E=f("div"),x=f("div"),L=f("label"),L.textContent="Theme",Z=b(),w=f("ul"),W=f("li"),z=f("button"),z.textContent="Standard",tt=b(),H=f("li"),I=f("button"),I.textContent="Standard (Dark)",et=b(),V=f("li"),$=f("button"),$.textContent="Retro",nt=b(),S=f("div"),h(t,"href",n=o[2]+"theme/"+o[1]),h(t,"rel","stylesheet"),h(t,"type","text/css"),h(d,"tabindex","0"),h(d,"class","btn btn-sm"),h(g,"class","btn-sm"),h(C,"class","btn-sm"),h(O,"class","btn-sm"),h(p,"tabindex","0"),h(p,"class","dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52"),h(a,"class","dropdown"),h(i,"class","flex-1"),h(L,"tabindex","0"),h(L,"class","btn btn-sm btn-outline"),h(z,"class","btn-sm"),h(I,"class","btn-sm"),h($,"class","btn-sm"),h(w,"tabindex","0"),h(w,"class","dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52"),h(x,"class","dropdown dropdown-end"),h(E,"class","flex-none"),h(r,"class","navbar px-5 fixed z-20 bg-white shadow-sm"),h(S,"class","w-full h-screen bg-white overflow-hidden relative select-none"),h(S,"id","node-editor")},m(v,j){_t(v,e,j),u(e,t),u(e,s),u(e,r),u(r,i),u(i,a),u(a,d),u(a,c),u(a,p),u(p,m),u(m,g),u(p,_),u(p,y),u(y,C),u(p,J),u(p,P),u(P,O),u(r,K),u(r,E),u(E,x),u(x,L),u(x,Z),u(x,w),u(w,W),u(W,z),u(w,tt),u(w,H),u(H,I),u(w,et),u(w,V),u(V,$),u(e,nt),u(e,S),Y||(ot=[k(g,"click",o[4]),k(C,"click",o[5]),k(O,"click",o[6]),k(z,"click",o[7]),k(I,"click",o[8]),k($,"click",o[9])],Y=!0)},p(v,[j]){j&2&&n!==(n=v[2]+"theme/"+v[1])&&h(t,"href",n)},i:F,o:F,d(v){v&&dt(e),Y=!1,M(ot)}}}function jt(o,e,t){const s="/SnapLineJS/";let r=null;Ct(async()=>{t(0,r=new Vt("node-editor"))});let i="standard.css";function a(y){t(1,i=y)}return[r,i,s,a,()=>r.addNode(Ut,0,0),()=>r.addNode(St,0,0),()=>r.addNode(At,0,0),()=>a("standard.css"),()=>a("dark.css"),()=>a("retro.css")]}class Bt extends Et{constructor(e){super(),Mt(this,e,jt,Yt,bt,{})}}new Bt({target:document.getElementById("app")});
