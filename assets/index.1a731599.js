var kt=Object.defineProperty;var Ct=(s,n,t)=>n in s?kt(s,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[n]=t;var a=(s,n,t)=>(Ct(s,typeof n!="symbol"?n+"":n,t),t);const It=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))e(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(o){if(o.ep)return;o.ep=!0;const i=t(o);fetch(o.href,i)}};It();function W(){}function wt(s){return s()}function ht(){return Object.create(null)}function T(s){s.forEach(wt)}function Ot(s){return typeof s=="function"}function zt(s,n){return s!=s?n==n:s!==n||s&&typeof s=="object"||typeof s=="function"}function Dt(s){return Object.keys(s).length===0}function d(s,n){s.appendChild(n)}function Mt(s,n,t){s.insertBefore(n,t||null)}function bt(s){s.parentNode.removeChild(s)}function p(s){return document.createElement(s)}function Lt(s){return document.createTextNode(s)}function g(){return Lt(" ")}function _(s,n,t,e){return s.addEventListener(n,t,e),()=>s.removeEventListener(n,t,e)}function f(s,n,t){t==null?s.removeAttribute(n):s.getAttribute(n)!==t&&s.setAttribute(n,t)}function Et(s){return Array.from(s.childNodes)}let $;function N(s){$=s}function Nt(){if(!$)throw new Error("Function called outside component initialization");return $}function $t(s){Nt().$$.on_mount.push(s)}const E=[],pt=[],V=[],ft=[],Tt=Promise.resolve();let tt=!1;function Ut(){tt||(tt=!0,Tt.then(xt))}function et(s){V.push(s)}const K=new Set;let P=0;function xt(){const s=$;do{for(;P<E.length;){const n=E[P];P++,N(n),St(n.$$)}for(N(null),E.length=0,P=0;pt.length;)pt.pop()();for(let n=0;n<V.length;n+=1){const t=V[n];K.has(t)||(K.add(t),t())}V.length=0}while(E.length);for(;ft.length;)ft.pop()();tt=!1,K.clear(),N(s)}function St(s){if(s.fragment!==null){s.update(),T(s.before_update);const n=s.dirty;s.dirty=[-1],s.fragment&&s.fragment.p(s.ctx,n),s.after_update.forEach(et)}}const Ft=new Set;function At(s,n){s&&s.i&&(Ft.delete(s),s.i(n))}function Ht(s,n,t,e){const{fragment:o,on_mount:i,on_destroy:r,after_update:l}=s.$$;o&&o.m(n,t),e||et(()=>{const u=i.map(wt).filter(Ot);r?r.push(...u):T(u),s.$$.on_mount=[]}),l.forEach(et)}function Pt(s,n){const t=s.$$;t.fragment!==null&&(T(t.on_destroy),t.fragment&&t.fragment.d(n),t.on_destroy=t.fragment=null,t.ctx=[])}function Vt(s,n){s.$$.dirty[0]===-1&&(E.push(s),Ut(),s.$$.dirty.fill(0)),s.$$.dirty[n/31|0]|=1<<n%31}function Wt(s,n,t,e,o,i,r,l=[-1]){const u=$;N(s);const c=s.$$={fragment:null,ctx:null,props:i,update:W,not_equal:o,bound:ht(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(n.context||(u?u.$$.context:[])),callbacks:ht(),dirty:l,skip_bound:!1,root:n.target||u.$$.root};r&&r(c.root);let h=!1;if(c.ctx=t?t(s,n.props||{},(m,w,...y)=>{const b=y.length?y[0]:w;return c.ctx&&o(c.ctx[m],c.ctx[m]=b)&&(!c.skip_bound&&c.bound[m]&&c.bound[m](b),h&&Vt(s,m)),w}):[],c.update(),h=!0,T(c.before_update),c.fragment=e?e(c.ctx):!1,n.target){if(n.hydrate){const m=Et(n.target);c.fragment&&c.fragment.l(m),m.forEach(bt)}else c.fragment&&c.fragment.c();n.intro&&At(s.$$.fragment),Ht(s,n.target,n.anchor,n.customElement),xt()}N(u)}class Bt{$destroy(){Pt(this,1),this.$destroy=W}$on(n,t){const e=this.$$.callbacks[n]||(this.$$.callbacks[n]=[]);return e.push(t),()=>{const o=e.indexOf(t);o!==-1&&e.splice(o,1)}}$set(n){this.$$set&&!Dt(n)&&(this.$$.skip_bound=!0,this.$$set(n),this.$$.skip_bound=!1)}}const Yt={functions:{visualize:{inputs:["Video ID","Show Controls"],outputs:[],functionInit:s=>{s.yt=s.dom.querySelector(".yt")},functionUpdate:(s,n,t)=>{n||(n="m4-HM_sCvtQ"),s.yt.src="https://www.youtube.com/embed/"+n+"?autoplay=1&controls="+(t?"1":"0")}}},elements:[{type:"input-text",name:"Video ID"},{type:"input-bool",name:"Show Controls"},{type:"custom",html:`
        <iframe class="yt rounded-lg" width="560" height="315" src="https://www.youtube.com/embed/m4-HM_sCvtQ?autoplay=1&controls=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      `}]},jt={functions:{output:{inputs:["Input 1","Input 2","Operation"],outputs:["Result"],functionUpdate:(s,n,t,e)=>{switch(e){case"+":return n+t;case"-":return n-t;case"*":return n*t;case"/":return n/t;default:return 0}}}},elements:[{type:"output-text",name:"Result"},[{type:"ui-dropdown",name:"Operation",values:[{value:"+",label:"Add"},{value:"-",label:"Subtract"},{value:"*",label:"Multiply"},{value:"/",label:"Divide"}]}],[{type:"input-text",name:"Input 1"}],[{type:"input-text",name:"Input 2"}]]},Rt={functions:{output:{inputs:["Input 1","Input 2","Alpha"],outputs:["Result"],functionUpdate:(s,n,t,e)=>(n=parseFloat(n),t=parseFloat(t),e=parseFloat(e),n+(t-n)*e)}},elements:[{type:"output-text",name:"Result"},{type:"input-text",name:"Input 1"},{type:"input-text",name:"Input 2"},{type:"input-float",name:"Alpha",min:0,max:1}]},Xt={functions:{output:{inputs:["Input"],outputs:[],functionInit:(s,n)=>{s.display=s.dom.querySelector(".display")},functionUpdate:(s,n)=>{s.display.innerText=n}}},elements:[{type:"input-text",name:"Input"},{type:"custom",name:"Display",html:`
      <div class="bg-red rounded-lg">
        <span class="display text-3xl"></span>
      </div>
      `}]};function mt(s,n,t){return s>=n&&s<=t||s>=t&&s<=n}function gt(s,n,t){const e=t.zoom,o=t.zoom,i=-s*t.zoom+t.cameraWidth/2,r=-n*t.zoom+t.cameraHeight/2;return`${e},0,0,0,0,${o},0,0,0,0,1,0,${i},${r},0,1`}function B(s,n){if(n.name==="")return;const t=document.createElement("span");return t.classList.add("sl-label"),t.innerText=n.name,t.style.zIndex="99",s.appendChild(t),t}class yt{constructor(n){a(this,"g");a(this,"gid");a(this,"position_x");a(this,"position_y");this.g=n,n.gid++,this.gid=n.gid.toString(),this.position_x=0,this.position_y=0}bindFunction(n){n.onmousedown=this.domMouseDown.bind(this)}domMouseDown(n){console.debug(this),this.g.isMouseDown=!0,this.g.targetNode=this,this.g.mousedown_x=n.clientX,this.g.mousedown_y=n.clientY,this.g.dx=0,this.g.dy=0,this.g.dx_offset=0,this.g.dy_offset=0,this.onFocus(),this.customMouseDown(n),n.stopPropagation()}customMouseDown(n){console.debug(n)}domMouseUp(){}onFocus(){}offFocus(){}onDrag(){}onPan(){}}class U extends yt{constructor(t,e,o){super(o);a(this,"parent");a(this,"config");a(this,"dom");this.config=t,this.parent=e,this.dom=null}}class _t extends U{constructor(t,e,o){super(t,e,o);a(this,"connector_x");a(this,"connector_y");a(this,"c_total_offset_x");a(this,"c_total_offset_y");a(this,"name");this.connector_x=0,this.connector_y=0,this.c_total_offset_x=0,this.c_total_offset_y=0,this.dom=null,t.name?this.name=t.name:(o.gid++,this.name=o.gid.toString()),this.g.globalNodes[this.gid]=this}pxToInt(t){return parseInt(t.substring(0,t.length-2))}getComputed(t,e){const o=window.getComputedStyle(t,null).getPropertyValue(e);return o.endsWith("px")?this.pxToInt(o):parseInt(o)}updateDOMproperties(){let e=this.dom.getBoundingClientRect(),o=this.parent.dom.getBoundingClientRect();this.c_total_offset_x=(e.left-o.left)/this.g.zoom+e.width/2/this.g.zoom,this.c_total_offset_y=(e.top-o.top)/this.g.zoom+e.height/2/this.g.zoom}setLineXY(t,e,o){t.setAttribute("x1",""+0),t.setAttribute("y1",""+0),t.setAttribute("x2",""+e),t.setAttribute("y2",""+o),t.setAttribute("stroke-width","4")}}class Gt extends _t{constructor(t,e,o,i){super(t,e,o);a(this,"inputDOM");a(this,"inter");a(this,"peerOutput");this.inter=i,this.inputDOM=null,this.peerOutput=null;const r=document.createElement("span");r.classList.add("sl-input-connector"),r.id=`input-${this.gid}`,r.onmousedown=this.domMouseDown.bind(this),this.dom=r}domMouseDown(t){this.peerOutput&&(super.domMouseDown(t),this.g.targetNode=this.peerOutput,this.g.dx_offset=(this.connector_x-this.peerOutput.connector_x)*this.g.zoom,this.g.dy_offset=(this.connector_y-this.peerOutput.connector_y)*this.g.zoom,this.g.dx=this.g.dx_offset,this.g.dy=this.g.dy_offset,this.peerOutput.customMouseDown(t),this.peerOutput.disconnectFromInput(this),t.stopPropagation())}updateConnectorPosition(){this.connector_x=this.parent.position_x+this.c_total_offset_x,this.connector_y=this.parent.position_y+this.c_total_offset_y}disconnectFromOutput(){var t,e;this.peerOutput=null,this.inter.dom.classList.remove("connected"),(e=(t=this.inter.inputUI)==null?void 0:t.inputDOM)==null||e.setAttribute("disabled","false")}connectToOutput(t){var e,o,i;this.peerOutput=t,(e=this.inter.dom)==null||e.classList.add("connected"),(i=(o=this.inter.inputUI)==null?void 0:o.inputDOM)==null||i.setAttribute("disabled","true")}nodeDrag(){this.updateConnectorPosition(),this.peerOutput&&this.peerOutput.nodeDrag()}}class qt extends _t{constructor(t,e,o){super(t,e,o);a(this,"val");a(this,"svgTmp");a(this,"svgs");this.val=null,this.svgTmp={svg:null,line:null},this.svgs=[];const i=document.createElement("span");i.classList.add("sl-output-connector"),i.id=`output-${this.gid}`,i.onmousedown=this.domMouseDown.bind(this),this.dom=i}connectToInput(t){if(console.debug("Connecting to input: ",t),this===t.peerOutput){console.debug("Already connected");return}t.peerOutput&&(console.debug("Disconnecting from: ",t.peerOutput),t.peerOutput.disconnectFromInput(t),t.disconnectFromOutput()),console.debug("Now connecting to: ",t),t.connectToOutput(this);const e=this.createNewSVG(),o=e[0],i=e[1],r={svg:o,line:i,to:t,from:this,connector_x:this.connector_x,connector_y:this.connector_y,x2:0,y2:0,connector:this};this.svgs.push(r),this.g.globalLines.push(r),this.g.canvas.appendChild(o),this.setLineXY(i,t.connector_x-this.connector_x,t.connector_y-this.connector_y),this.parent.outputCount++,t.parent.inputCount++}disconnectFromInput(t){console.debug("Disconnecting from input: ",t);for(const e of this.svgs)if(e.to==t){this.g.canvas.removeChild(e.svg),this.svgs=this.svgs.filter(o=>o!=e),this.g.globalLines=this.g.globalLines.filter(o=>o!=e),console.debug("Deleted line: ",e);break}t.disconnectFromOutput(),this.parent.outputCount--,t.parent.inputCount--}updateConnectorPosition(){this.connector_x=this.parent.position_x+this.c_total_offset_x,this.connector_y=this.parent.position_y+this.c_total_offset_y}moveToParent(){if(this.updateConnectorPosition(),this.svgTmp.line&&(this.svgTmp.svg.style.transform=`translate3d(${this.connector_x}px, ${this.connector_y}px, 0)`),!(this.svgs.length<1))for(const t of this.svgs)t.svg.style.transform=`translate3d(${this.connector_x}px, ${this.connector_y}px, 0)`,t.connector_x=this.connector_x,t.connector_y=this.connector_y,t.x2=t.to.connector_x-this.connector_x,t.y2=t.to.connector_y-this.connector_y,this.setLineXY(t.line,t.x2,t.y2)}createNewSVG(){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("sl-connector-svg"),t.style.pointerEvents="none",t.style.position="absolute",t.style.overflow="visible",t.setAttribute("width","4"),t.setAttribute("height","4"),t.style.willChange="transform";const e=document.createElementNS("http://www.w3.org/2000/svg","line");return e.classList.add("sl-connector-line"),e.setAttribute("stroke-width","4"),t.appendChild(e),this.updateConnectorPosition(),console.debug("connector x: "+this.connector_x),t.style.transform=`translate3d(${this.connector_x}px, ${this.connector_y}px, 0)`,this.g.canvas.appendChild(t),[t,e]}customMouseDown(t){const e=this.createNewSVG();this.svgTmp.svg=e[0],this.svgTmp.line=e[1],this.moveToParent(),this.setLineXY(this.svgTmp.line,this.g.dx,this.g.dy)}onDrag(){let t=9999,e=0,o=0;const i=this.g.hoverDOM;if(i&&i.id&&i.id.startsWith("input-")){const r=i.id.split("-")[1],l=this.g.globalNodes[r];l.updateConnectorPosition(),e=l.connector_x,o=l.connector_y,t=Math.sqrt(Math.pow(this.connector_x+this.g.dx/this.g.zoom-e,2)+Math.pow(this.connector_y+this.g.dy/this.g.zoom-o,2))}t<40?this.setLineXY(this.svgTmp.line,e-this.connector_x,o-this.connector_y):this.setLineXY(this.svgTmp.line,this.g.dx/this.g.zoom,this.g.dy/this.g.zoom)}nodeDrag(){this.moveToParent()}domMouseUp(){const t=this.g.hoverDOM;if(t&&t.id&&t.id.startsWith("input-")){console.debug("Connecting to input: ",t.id);const e=this.g.globalNodes[t.id.split("-")[1]];this.connectToInput(e),e.parent.findLeaf()}this.g.canvas.removeChild(this.svgTmp.svg),this.svgTmp={svg:null,line:null}}getValue(){return this.parent.exec(),this.val}}class nt extends U{constructor(t,e,o,i){super(t,e,o);a(this,"inputDOM");a(this,"inputItf");this.inputDOM=null,this.inputItf=i}triggerExec(t){var e;(e=this.inputItf.parent)==null||e.findLeaf()}}class Qt extends nt{constructor(n,t,e,o){super(n,t,e,o),B(o.dom,n);const i=document.createElement("input");i.classList.add("sl-input-text"),i.type="text",o.dom.appendChild(i),this.inputDOM=i,i.onkeyup=this.triggerExec.bind(this)}getInputValue(){return this.inputDOM.value}}class Jt extends nt{constructor(n,t,e,o){super(n,t,e,o),B(o.dom,n);const i=document.createElement("input");i.classList.add("sl-input-bool"),i.type="checkbox",o.dom.appendChild(i),this.inputDOM=i,i.onkeyup=this.triggerExec.bind(this)}getInputValue(){return this.inputDOM.checked}}class Kt extends nt{constructor(t,e,o,i){super(t,e,o,i);a(this,"cur_w");a(this,"x_cur");a(this,"x_min");a(this,"x_max");a(this,"slider_w");a(this,"floatSliderContainer");a(this,"floatSlider");a(this,"floatEditor");a(this,"floatContainer");this.x_cur=0,this.x_min="x_min"in t?t.x_min:0,this.x_max="x_max"in t?t.x_max:this.x_min+1,this.slider_w=0,this.cur_w=0;const r=document.createElement("div"),l=document.createElement("input"),u=document.createElement("div"),c=document.createElement("div");r.classList.add("sl-input-float-container"),r.style.position="relative",r.style.overflow="hidden",r.style.flexGrow="1",r.style.display="flex",l.classList.add("sl-input-float-editor"),l.style.backgroundColor="transparent",l.style.position="relative",l.style.width="100%",l.type="text",l.style.textAlign="right",l.style.zIndex="10",u.classList.add("sl-input-float-slider-container"),u.style.position="relative",u.style.zIndex="1",u.style.overflow="hidden",c.classList.add("sl-input-float-slider"),c.style.width="10px",c.style.height="100%",c.style.top="0px",c.style.left="0",c.style.position="absolute",c.style.zIndex="10",u.appendChild(c),B(r,t),r.appendChild(u),u.appendChild(l),i.dom.appendChild(r),this.inputDOM=l,l.onchange=this.triggerExec.bind(this),c.onmousedown=this.triggerExec.bind(this),this.floatSlider=c,this.floatEditor=l,this.floatContainer=r,this.floatSliderContainer=u,this.bindFunction(r)}customMouseDown(){this.cur_w=parseInt(this.floatSlider.style.width,10),this.slider_w=this.floatSliderContainer.getBoundingClientRect().width/this.g.zoom,console.log(this.slider_w),this.floatEditor.blur()}onDrag(){var r;this.floatEditor.blur();const t=50,e=(this.x_max-this.x_min)/t,o=this.slider_w/t;let i=this.cur_w+this.g.dx/this.g.zoom;i=Math.ceil(i/o)*o,i=Math.min(Math.max(i,0),this.slider_w),this.floatSlider.style.width=i+"px",this.x_cur=Math.min(Math.max(this.x_min+i/this.slider_w,this.x_min),this.x_max),this.x_cur=Math.ceil(this.x_cur/e)*e,this.floatEditor.value=this.x_cur+"",(r=this.inputItf.parent)==null||r.findLeaf()}domMouseUp(){this.floatEditor.focus()}getInputValue(){return parseFloat(this.inputDOM.value)}}class vt extends U{constructor(t,e,o){super(t,e,o);a(this,"name");this.name=t.name,this.parent.elements[this.name]=this}}class Zt extends vt{constructor(t,e,o){super(t,e,o);a(this,"input");a(this,"inputUI");a(this,"name");const i=document.createElement("div");switch(i.classList.add("sl-input"),i.style.position="relative",this.input=new Gt(t,e,o,this),i.appendChild(this.input.dom),this.dom=i,this.name=t.name,this.parent.elements[this.name]=this,t.type){case"input-text":this.inputUI=new Qt(t,e,o,this);break;case"input-bool":this.inputUI=new Jt(t,e,o,this);break;case"input-float":this.inputUI=new Kt(t,e,o,this);break;default:this.inputUI=null}this.bindFunction(this.dom)}getValue(){return this.input.peerOutput?this.input.peerOutput.getValue():this.inputUI?this.inputUI.getInputValue():null}}class te extends vt{constructor(t,e,o){super(t,e,o);a(this,"output");a(this,"name");const i=document.createElement("div");i.classList.add("sl-output"),i.style.position="relative",B(i,t),this.output=new qt(t,e,o),i.appendChild(this.output.dom),this.dom=i,this.name=t.name,this.parent.elements[this.name]=this}getValue(){return this.parent.exec(),this.output.val}setValue(t){this.output.val=t}}class ee extends U{constructor(t,e,o,i){super(t,e,o);a(this,"parentContent");a(this,"getUIvalue");a(this,"setUIvalue");a(this,"name");this.parentContent=i,this.name=t.name,this.getUIvalue=()=>null,this.setUIvalue=u=>{console.debug(u)};const r=document.createElement("div");switch(r.classList.add("sl-ui"),t.type){case"ui-paragraph":const u=document.createElement("p");u.style.pointerEvents="none",u.innerText=t.text,r.appendChild(u);break;case"ui-display":const c=document.createElement("p");c.style.pointerEvents="none",c.innerText="Output",r.appendChild(c),this.setSetFunction(m=>{c.innerText=m});break;case"ui-dropdown":const h=document.createElement("select");h.classList.add("sl-ui-dropdown");for(const m of t.values){const w=document.createElement("option");w.innerText=m.label,w.value=m.value,h.appendChild(w)}r.appendChild(h),this.setGetFunction(()=>h.value),this.setExecTrigger(h,"change");break}this.dom=r,this.name&&(this.parent.elements[this.name]=this)}setExecTrigger(t,e){t.addEventListener(e,()=>{var o;(o=this.parent)==null||o.findLeaf()}),console.debug(t,e)}setGetFunction(t){this.getUIvalue=t}setSetFunction(t){this.setUIvalue=t}getValue(){return this.getUIvalue()}setValue(t){return this.setUIvalue(t)}}class ne extends U{constructor(t,e,o,i){super(t,e,o);a(this,"parentContent");a(this,"getUIvalue");a(this,"setUIvalue");this.parentContent=i,this.getUIvalue=()=>null,this.setUIvalue=l=>{console.debug(l)};const r=document.createElement("template");r.innerHTML=t.html.trim(),this.dom=r.content.firstChild}setExecTrigger(t,e){console.debug(t,e)}setGetFunction(t){this.getUIvalue=t}setSetFunction(t){this.setUIvalue=t}getValue(){return this.getUIvalue()}setValue(t){return this.setUIvalue(t)}}class Z extends yt{constructor(t,e,o=0,i=0){super(e);a(this,"config");a(this,"inputs");a(this,"outputs");a(this,"inputCount");a(this,"outputCount");a(this,"elements");a(this,"dom");a(this,"hasIandO");a(this,"nodeWidth");a(this,"nodeHeight");a(this,"nodeContainerWidth");a(this,"nodeContainerHeight");a(this,"nodeContainerOffsetLeft");a(this,"nodeContainerOffsetTop");a(this,"functions");a(this,"pan_start_x");a(this,"pan_start_y");a(this,"overlapping");this.config=t,this.position_x=o,this.position_y=i,this.inputs=[],this.outputs=[],this.inputCount=0,this.outputCount=0,this.elements={},this.pan_start_x=0,this.pan_start_y=0,this.overlapping=null;const r=document.createElement("div");r.classList.add("sl-node"),r.style.willChange="transform",r.style.position="absolute",r.style.transformOrigin="top left",r.style.position="absolute";const l=document.createElement("div");l.classList.add("sl-node-container"),l.style.position="relative";for(const u of t.elements){const c=document.createElement("div");if(c.style.position="relative",c.style.display="flex",c.style.flexDirection="row",c.classList.add("sl-node-content"),l.appendChild(c),u instanceof Array)for(const h of u){const m=this._initParseComponent(h,c);m&&c.appendChild(m.dom)}else{const h=this._initParseComponent(u,c);h&&c.appendChild(h.dom)}l.appendChild(c)}if(r.appendChild(l),r.id=this.gid,r.onmousedown=this.domMouseDown.bind(this),this.dom=r,this.inputs.length>0&&this.outputs.length>0?this.hasIandO=!0:this.hasIandO=!1,this.g.canvas.appendChild(r),this.nodeWidth=r.offsetWidth,this.nodeHeight=r.offsetHeight,this.nodeContainerWidth=l.offsetWidth,this.nodeContainerHeight=l.offsetHeight,this.nodeContainerOffsetLeft=l.offsetLeft,this.nodeContainerOffsetTop=l.offsetTop,this.updateDOMproperties(),this.g.nodeArray.push(this),new ResizeObserver(()=>{this.updateDOMproperties()}).observe(this.dom),this.functions=[],t.functions){this.functions=t.functions;for(const[u,c]of Object.entries(this.functions))c.functionInit!==void 0&&c.functionInit(this)}}findInput(t){for(const e of this.inputs)if(e.gid===t)return e;return null}findOutput(t){for(const e of this.outputs)if(e.gid===t)return e;return null}_initParseComponent(t,e){let o=null;switch(t.type){case"input-text":case"input-bool":case"input-float":o=new Zt(t,this,this.g),o.parent=this,this.g.globalNodes[o.gid]=o,this.inputs.push(o);break;case"output-text":o=new te(t,this,this.g),o.parent=this,this.g.globalNodes[o.gid]=o,this.outputs.push(o);break;case"ui-display":case"ui-dropdown":case"ui-paragraph":o=new ee(t,this,this.g,e),o.parent=this,this.g.globalNodes[o.gid]=o;break;case"custom":o=new ne(t,this,this.g,e),o.parent=this,this.g.globalNodes[o.gid]=o;break;default:console.warn("Unknown type "+t.type)}return o}customMouseDown(t){this.pan_start_x=this.position_x,this.pan_start_y=this.position_y,this.g.focusNode=this}domMouseUp(){if(this.position_x=this.pan_start_x+this.g.dx/this.g.zoom,this.position_y=this.pan_start_y+this.g.dy/this.g.zoom,this.overlapping==null)return;const t=this.overlapping.from,e=this.overlapping.to,o=this.inputs[0],i=this.outputs[0];t.disconnectFromInput(e),t.connectToInput(o.input),i.output.connectToInput(e)}onDrag(){this.position_x=this.pan_start_x+this.g.dx/this.g.zoom,this.position_y=this.pan_start_y+this.g.dy/this.g.zoom,this.dom.style.transform=`translate3d(${this.position_x}px, ${this.position_y}px, 0)`;for(const e of this.inputs)e.input.nodeDrag();for(const e of this.outputs)e.output.nodeDrag();if(this.overlapping=null,!this.hasIandO||this.outputCount>0||this.inputCount>0)return;let t=9999;for(const e of this.g.globalLines)e.line.classList.remove("overlapping"),mt(this.position_x+this.nodeWidth/2,e.connector_x,e.connector_x+e.x2)&&mt(this.position_y+this.nodeHeight/2,e.connector_y,e.connector_y+e.y2)&&(e.y2+e.connector_x)/2<t&&(this.overlapping=e,t=(e.y2+this.position_y)/2);!this.overlapping||this.overlapping.line.classList.add("overlapping")}onFocus(){for(const t of this.g.nodeArray)t.dom.classList.remove("focused"),t.dom.style.zIndex="10";this.dom.classList.add("focused"),this.dom.style.zIndex="20",this.updateDOMproperties()}offFocus(){this.dom.classList.remove("focused"),this.dom.style.zIndex="10"}updateDOMproperties(){this.nodeHeight=this.dom.offsetHeight,this.nodeWidth=this.dom.offsetWidth;for(const t of this.inputs)t.input.updateDOMproperties();for(const t of this.outputs)t.output.updateDOMproperties()}findLeaf(){var e;let t=0;for(const[o,i]of Object.entries(this.functions))for(const r of i.outputs){const l=this.elements[r];if(l==null){console.warn(`Output '${r}' was not found in elements. Double check '${r}' is defined.`);return}if(!(!l.output.svgs||l.output.svgs.length<1)){t++;for(const u of l.output.svgs)(e=u.to.parent)==null||e.findLeaf()}}t===0&&this.exec()}exec(){if(!!this.functions)for(const[t,e]of Object.entries(this.functions)){const o=[this];for(const r of e.inputs)if(r in this.elements){const l=this.elements[r];o.push(l.getValue())}const i=e.functionUpdate(...o);for(const r of e.outputs){const l=this.elements[r];if(l==null){console.warn(`Output '${r}' was not found in elements. Double check '${r}' is defined.`);return}l.setValue(i)}}}}class oe{constructor(n){a(this,"g");this.g={canvas:null,canvasContainer:null,canvasBackground:null,isMouseDown:!1,mousedown_x:0,mousedown_y:0,mouse_x:0,mouse_y:0,camera_pan_start_x:0,camera_pan_start_y:0,dx:0,dy:0,dx_offset:0,dy_offset:0,camera_x:0,camera_y:0,zoom:1,cameraWidth:0,cameraHeight:0,targetNode:null,focusNode:null,hoverDOM:null,gid:0,nodeArray:[],globalLines:[],globalNodes:{}};const t=this.g;if(t.canvasContainer=document.getElementById(n),!t.canvasContainer){console.error("Canvas not found");return}t.cameraWidth=t.canvasContainer.clientWidth,t.cameraHeight=t.canvasContainer.clientHeight,console.debug(`Canvas size: ${t.cameraWidth}x${t.cameraHeight}`);const e=document.createElement("div");e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.className="canvas",t.canvasContainer.appendChild(e),t.canvas=e,t.canvas.style.transform=`translate(${t.cameraWidth/2}px, ${t.cameraHeight/2}px)`,t.canvasContainer.tabIndex=0;const o=document.createElement("div");o.id="sl-background",o.style.width=t.cameraWidth*10+"px",o.style.height=t.cameraHeight*10+"px",o.style.transform=`translate(${-t.cameraWidth*5}px, ${-t.cameraHeight*5}px)`,o.style.transformOrigin="center",o.style.zIndex="0",o.style.position="absolute",t.canvas.appendChild(o),t.canvasBackground=o,t.canvasContainer.addEventListener("mousedown",function(i){t.isMouseDown=!0,t.mousedown_x=i.clientX,t.mousedown_y=i.clientY,t.camera_pan_start_x=t.camera_x,t.camera_pan_start_y=t.camera_y,t.focusNode=null;for(const r of t.nodeArray)r.offFocus()}),t.canvasContainer.addEventListener("mousemove",function(i){t.hoverDOM=i.target,t.mouse_x=i.clientX-t.canvasContainer.offsetLeft,t.mouse_y=i.clientY-t.canvasContainer.offsetTop,t.isMouseDown&&(t.dx=i.clientX-t.mousedown_x+t.dx_offset,t.dy=i.clientY-t.mousedown_y+t.dy_offset,t.targetNode==null&&(t.camera_x=t.camera_pan_start_x-t.dx/t.zoom,t.camera_y=t.camera_pan_start_y-t.dy/t.zoom,t.canvas.style.transform=`matrix3d(${gt(t.camera_x,t.camera_y,t)})`,t.canvasBackground.style.transform=`translate(${t.camera_x+-t.cameraWidth*5}px, ${t.camera_y+-t.cameraHeight*5}px)`,t.canvasBackground.style.backgroundPosition=`${-t.camera_x}px ${-t.camera_y}px`,t.canvas.style.cursor="grabbing"))}),t.canvasContainer.addEventListener("wheel",function(i){let r=1*t.zoom*(-i.deltaY/600);i.preventDefault(),t.zoom+r<.2?(t.zoom=.2,r=0):t.zoom+r>3&&(t.zoom=3,r=0);const l=(t.mouse_x-t.cameraWidth/2)*r,u=(t.mouse_y-t.cameraHeight/2)*r;t.zoom+=r,t.camera_x+=l/t.zoom/t.zoom,t.camera_y+=u/t.zoom/t.zoom,t.canvas.style.transform=`matrix3d(${gt(t.camera_x,t.camera_y,t)})`,i.preventDefault()}),t.canvasContainer.addEventListener("mouseup",function(i){t.isMouseDown=!1,t.canvas.style.cursor="default",t.targetNode==null||t.targetNode.domMouseUp(),t.targetNode=null,t.dx=0,t.dy=0,t.dx_offset=0,t.dy_offset=0}),t.canvasContainer.addEventListener("keydown",i=>{switch(i.key){case"Delete":t.focusNode&&(console.debug("Delete Node "+t.focusNode.gid),this.deleteNode(t.focusNode.gid));break}}),console.info("Initialized SnapLine..."),window.requestAnimationFrame(this.step.bind(this))}step(){this.g.targetNode&&this.g.targetNode.onDrag(),window.requestAnimationFrame(this.step.bind(this))}addNode(n,t,e){const o=new Z(n,this.g,t,e);return this.g.globalNodes[o.gid]=o,this.focusNode(o.gid),o}deleteNode(n){var e;if(!(n in this.g.globalNodes))return null;const t=this.g.globalNodes[n];return(e=this.g.canvas)==null||e.removeChild(t.dom),delete this.g.globalNodes[n],n}focusNode(n){return n in this.g.globalNodes?(this.g.globalNodes[n].onFocus(),n):null}connectNodes(n,t,e,o){const i=this.g.globalNodes[n],r=this.g.globalNodes[e];if(!i||!r||!(i instanceof Z)||!(r instanceof Z))return null;const l=i.findOutput(t),u=r.findInput(o);return!l||!u?null:(l.output.connectToInput(u.input),0)}}function se(s){let n,t,e,o,i,r,l,u,c,h,m,w,y,b,S,Y,C,ot,F,st,j,I,it,R,O,rt,A,v,z,at,x,X,D,lt,G,M,ct,q,L,ut,H,Q,dt;return{c(){n=p("main"),t=p("link"),o=g(),i=p("navbar"),r=p("div"),l=p("div"),u=p("label"),u.textContent="Add Node",c=g(),h=p("ul"),m=p("div"),m.textContent="Output",w=g(),y=p("li"),b=p("button"),b.textContent="Print",S=g(),Y=p("li"),C=p("button"),C.textContent="YouTube",ot=g(),F=p("div"),F.textContent="Math",st=g(),j=p("li"),I=p("button"),I.textContent="Operator",it=g(),R=p("li"),O=p("button"),O.textContent="Lerp",rt=g(),A=p("div"),v=p("div"),z=p("label"),z.textContent="Theme",at=g(),x=p("ul"),X=p("li"),D=p("button"),D.textContent="Standard",lt=g(),G=p("li"),M=p("button"),M.textContent="Standard (Dark)",ct=g(),q=p("li"),L=p("button"),L.textContent="Retro",ut=g(),H=p("div"),f(t,"href",e=s[2]+"theme/"+s[1]),f(t,"rel","stylesheet"),f(t,"type","text/css"),f(u,"tabindex","0"),f(u,"class","btn btn-sm"),f(m,"class","divider"),f(b,"class","btn-sm"),f(C,"class","btn-sm"),f(F,"class","divider"),f(I,"class","btn-sm"),f(O,"class","btn-sm"),f(h,"tabindex","0"),f(h,"class","dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52"),f(l,"class","dropdown"),f(r,"class","flex-1"),f(z,"tabindex","0"),f(z,"class","btn btn-sm btn-outline"),f(D,"class","btn-sm"),f(M,"class","btn-sm"),f(L,"class","btn-sm"),f(x,"tabindex","0"),f(x,"class","dropdown-content menu p-2 shadow bg-base-100 rounded-box w-52"),f(v,"class","dropdown dropdown-end"),f(A,"class","flex-none"),f(i,"class","navbar px-5 fixed z-20 bg-white shadow-sm"),f(H,"class","w-full h-screen bg-white overflow-hidden relative select-none"),f(H,"id","node-editor")},m(k,J){Mt(k,n,J),d(n,t),d(n,o),d(n,i),d(i,r),d(r,l),d(l,u),d(l,c),d(l,h),d(h,m),d(h,w),d(h,y),d(y,b),d(h,S),d(h,Y),d(Y,C),d(h,ot),d(h,F),d(h,st),d(h,j),d(j,I),d(h,it),d(h,R),d(R,O),d(i,rt),d(i,A),d(A,v),d(v,z),d(v,at),d(v,x),d(x,X),d(X,D),d(x,lt),d(x,G),d(G,M),d(x,ct),d(x,q),d(q,L),d(n,ut),d(n,H),Q||(dt=[_(b,"click",s[4]),_(C,"click",s[5]),_(I,"click",s[6]),_(O,"click",s[7]),_(D,"click",s[8]),_(M,"click",s[9]),_(L,"click",s[10])],Q=!0)},p(k,[J]){J&2&&e!==(e=k[2]+"theme/"+k[1])&&f(t,"href",e)},i:W,o:W,d(k){k&&bt(n),Q=!1,T(dt)}}}function ie(s,n,t){const o="/SnapLineJS/";let i=null;$t(async()=>{t(0,i=new oe("node-editor"))});let r="standard.css";function l(S){t(1,r=S)}return[i,r,o,l,()=>i.addNode(Xt,0,0),()=>i.addNode(Yt,0,0),()=>i.addNode(jt,0,0),()=>i.addNode(Rt,0,0),()=>l("standard.css"),()=>l("dark.css"),()=>l("retro.css")]}class re extends Bt{constructor(n){super(),Wt(this,n,ie,se,zt,{})}}new re({target:document.getElementById("app")});
